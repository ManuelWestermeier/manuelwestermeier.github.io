<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Farbe ersetzen / invertieren</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  canvas { border: 1px solid #ccc; margin-top: 10px; }
  label { display: block; margin-top: 10px; }
</style>
</head>
<body>

<h1>Bildfarbe ersetzen oder invertieren</h1>

<input type="file" id="imageInput" accept="image/*">
<label>
  <input type="radio" name="mode" value="replace" checked>
  Häufigste Farbe mit Weiß ersetzen
</label>
<label>
  <input type="radio" name="mode" value="invert">
  Farben invertieren, sodass häufigste Farbe Weiß wird
</label>

<canvas id="canvas"></canvas>

<script>
const imageInput = document.getElementById('imageInput');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

imageInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const img = new Image();
    img.onload = () => processImage(img);
    img.src = URL.createObjectURL(file);
});

function processImage(img) {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);

    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;

    // Häufigste Farbe finden
    const colorCount = {};
    for (let i = 0; i < data.length; i += 4) {
        const key = `${data[i]},${data[i+1]},${data[i+2]}`;
        colorCount[key] = (colorCount[key] || 0) + 1;
    }

    let mostFrequentColor = null;
    let maxCount = 0;
    for (const color in colorCount) {
        if (colorCount[color] > maxCount) {
            maxCount = colorCount[color];
            mostFrequentColor = color.split(',').map(Number);
        }
    }

    const mode = document.querySelector('input[name="mode"]:checked').value;

    if (mode === 'replace') {
        // Ersetze die häufigste Farbe mit Weiß
        for (let i = 0; i < data.length; i += 4) {
            if (data[i] === mostFrequentColor[0] &&
                data[i+1] === mostFrequentColor[1] &&
                data[i+2] === mostFrequentColor[2]) {
                data[i] = 255;
                data[i+1] = 255;
                data[i+2] = 255;
            }
        }
    } else if (mode === 'invert') {
        // Berechne Farbverschiebung
        const rShift = 255 - mostFrequentColor[0];
        const gShift = 255 - mostFrequentColor[1];
        const bShift = 255 - mostFrequentColor[2];

        for (let i = 0; i < data.length; i += 4) {
            data[i] = clamp(data[i] + rShift);
            data[i+1] = clamp(data[i+1] + gShift);
            data[i+2] = clamp(data[i+2] + bShift);
        }
    }

    ctx.putImageData(imageData, 0, 0);
}

function clamp(value) {
    return Math.max(0, Math.min(255, value));
}
</script>

</body>
</html>
