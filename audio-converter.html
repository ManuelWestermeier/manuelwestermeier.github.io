<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MP3 to 8-bit PCM Converter</title>
</head>
<body>
<h2>MP3 → 8-bit PCM Converter</h2>

<label for="audioFile">Select MP3 file:</label>
<input type="file" id="audioFile" accept="audio/*"><br><br>

<label for="sampleRate">Sample rate (Hz): <span id="rateValue">8000</span></label>
<input type="range" id="sampleRate" min="1000" max="44100" value="8000" step="100"><br><br>

<button id="convertBtn">Convert & Download</button>

<script>
const fileInput = document.getElementById('audioFile');
const convertBtn = document.getElementById('convertBtn');
const sampleRateSlider = document.getElementById('sampleRate');
const rateValue = document.getElementById('rateValue');

sampleRateSlider.oninput = () => {
    rateValue.textContent = sampleRateSlider.value;
};

convertBtn.onclick = async () => {
    const file = fileInput.files[0];
    if (!file) return alert("Select an MP3 file first");

    const filename = prompt("Enter filename for the converted file:", file.name.replace(/\.\w+$/, '_8bit.pcm'));
    if (!filename) return;

    const arrayBuffer = await file.arrayBuffer();
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

    const rate = parseInt(sampleRateSlider.value);
    const length = Math.floor(audioBuffer.length * rate / audioBuffer.sampleRate);
    const channelData = audioBuffer.getChannelData(0); // first channel
    const pcm8 = new Uint8Array(length);

    for (let i = 0; i < length; i++) {
        const idx = Math.floor(i * audioBuffer.sampleRate / rate);
        const sample = channelData[idx];
        pcm8[i] = Math.floor((sample + 1) * 127.5); // convert -1..1 → 0..255
    }

    const blob = new Blob([pcm8], {type: "application/octet-stream"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
};
</script>
</body>
</html>
